-# encoding: utf-8
%header
  .subnav.subnav-fixed
    %ul.nav.nav-pills
      %li{:class => current_page?(documents_path) ? "active" : nil}
        %a{:href => documents_path}= t "documents.documents"
      %li{:class => current_page?(search_documents_path) ? "active" : nil}
        %a{:href => search_documents_path}= t "documents.search"
      %li{:class => current_page?(new_document_path) ? "active" : nil}
        %a{:href => new_document_path}= t "documents.new"

.row-fluid
  .content
    .row-fluid
      %h2
        = @search.total
        resultados
    .row-fluid
      %table{:class => 'table documents'}
        %thead
          %tr
            %th{:style => "width: 70px"}
            %th
        %tbody
          - @results.each do |item, document|
            %tr{:"data-id" => document.id}
              %td{:style => "width: 70px"}
                .thumbnail
                  %img{:src => thumbnail_url(document)}
              %td
                %h4.heading= item.highlight.try(:[], :heading).try(:first).try(:html_safe) || document.heading
                .small
                  = document.category
                  = document._id.generation_time.strftime("%d/%m/%y")
                  - if item.highlight && pages = item.highlight.to_hash.keys.grep(/^\d+$/).map { |p| p.to_s.to_i }
                    %ul.highlights
                      - pages.sort.each do |page_num|
                        %li
                          %strong= "p.#{page_num}"
                          = "..."
                          = item.highlight[page_num.to_s].first.gsub("\n", " ").html_safe
                          = "..."
                -#
                  .tools
                    .btn-group.pull-right
                      %a.btn.btn-small{:href => '#', :class => (document.readable? ? nil : "disabled")}
                        %i.icon-edit{:title => "Editar"}
                      %a.btn.btn-small{:href => '#', :class => (document.geocoded? ? nil : "disabled")}
                        %i.icon-globe{:title => "Mapa"}
                      %a.btn.btn-small{:href => '#'}
                        %i.icon-download-alt{:title => "Descargar"}
                      %a.btn.btn-small{:href => '#', :class => (document.exportable? ? nil : "disabled")}
                        %i.icon-list-alt{:title => "Exportar a CSV"}
                    .state.pull-right
                      - if document.processed?
                        .hidden{:style => "display: none;"}
                          .progress.progress-striped.active
                            .bar{:style => "width: 100%;"}
                      - else
                        .progress.progress-striped.active
                          .bar{:style => "width: #{document.state_to_percentage}%;"}
    .row-fluid
      = will_paginate @search, :renderer => BootstrapPagination::Rails

- content_for :sidebar do
  %ul.nav.nav-list#sidebar
    %li.nav-header Filtros de búsqueda
    %ul#filters
      %li.document
        Documento
        %form.navbar-search.pull-left
          %input.search-query{name: "q", value: params[:q], type: "search", placeholder: "Buscar por título o contenido"}
          %button.btn{type: "submit"} Buscar
